<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Acomoda App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background-color: #f4f4f7;
      color: #222;
    }
    body {
      margin: 0;
      padding: 0;
      display: flex;
      min-height: 100vh;
      align-items: center;
      justify-content: center;
    }
    .card {
      background: #fff;
      padding: 1.5rem;
      border-radius: 0.75rem;
      box-shadow: 0 4px 16px rgba(0,0,0,0.08);
      max-width: 420px;
      width: 100%;
    }
    h1 {
      margin-top: 0;
      font-size: 1.4rem;
      text-align: center;
    }
    h2 {
      font-size: 1.1rem;
      margin-bottom: 0.75rem;
      text-align: center;
    }
    .sub {
      font-size: 0.9rem;
      color: #555;
      text-align: center;
      margin-bottom: 1rem;
    }
    label {
      font-size: 0.9rem;
      display: block;
      margin: 0.4rem 0 0.2rem;
    }
    input[type="password"],
    input[type="text"],
    select {
      width: 100%;
      padding: 0.55rem 0.6rem;
      border-radius: 0.4rem;
      border: 1px solid #ccc;
      font-size: 0.95rem;
      box-sizing: border-box;
    }
    .rol-row {
      display: flex;
      gap: 0.75rem;
      margin-bottom: 0.5rem;
      justify-content: center;
    }
    .rol-row label {
      display: flex;
      align-items: center;
      gap: 0.35rem;
      margin: 0;
      font-size: 0.9rem;
    }
    button {
      width: 100%;
      margin-top: 0.9rem;
      padding: 0.65rem;
      font-size: 0.95rem;
      border-radius: 0.5rem;
      border: none;
      cursor: pointer;
      background: #2563eb;
      color: white;
      font-weight: 600;
    }
    button:active {
      transform: scale(0.98);
    }
    .small-btn {
      width: auto;
      padding: 0.45rem 0.7rem;
      font-size: 0.8rem;
      margin-top: 0.5rem;
      background: #6b7280;
    }
    .estado {
      margin-top: 0.6rem;
      font-size: 0.8rem;
      text-align: center;
    }
    .estado.ok {
      color: #16a34a;
    }
    .estado.err {
      color: #b91c1c;
    }
    .app-section {
      margin-top: 1rem;
      border-top: 1px solid #e5e7eb;
      padding-top: 0.8rem;
      font-size: 0.9rem;
    }
    .chip {
      display: inline-block;
      padding: 0.15rem 0.5rem;
      border-radius: 999px;
      background: #e5e7eb;
      font-size: 0.8rem;
      margin-bottom: 0.3rem;
    }
    #resultadoFirebase {
      margin-top: 0.45rem;
      font-size: 0.8rem;
      text-align: center;
    }
  </style>

  <!-- Firebase compat -->
  <script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <div class="card">
    <h1>ACOMODA APP</h1>
    <div class="sub">Control de asignaciones y recordatorios</div>

    <!-- Login / Ingreso -->
    <div id="loginSection">
      <h2>Ingreso</h2>

      <div class="rol-row">
        <label>
          <input type="radio" name="rol" value="coordinador" />
          Coordinador
        </label>
        <label>
          <input type="radio" name="rol" value="acomodador" />
          Acomodador
        </label>
      </div>

      <label for="pinInput">PIN</label>
      <input id="pinInput" type="password" placeholder="Ingrese su PIN" />

      <button onclick="entrar()">Entrar</button>

      <div id="estadoConexion" class="estado"></div>

      <!-- Bot√≥n para probar Firebase (solo para vos) -->
      <div style="text-align:center; margin-top:0.5rem;">
        <button class="small-btn" type="button" onclick="probarFirebase()">
          Probar Firebase
        </button>
        <div id="resultadoFirebase"></div>
      </div>
    </div>

    <!-- Secci√≥n principal de la app, se muestra luego de entrar -->
    <div id="appSection" style="display:none;">
      <h2>Panel</h2>
      <div class="chip" id="infoUsuario"></div>

      <div class="app-section">
        <p>
          Aqu√≠ despu√©s vamos a mostrar:
        </p>
        <ul>
          <li>Programa mensual de asignaciones.</li>
          <li>Asignaciones de cada acomodador.</li>
          <li>Sincronizaci√≥n con Firebase (para ver cambios en tiempo real).</li>
        </ul>
        <p style="font-size:0.8rem; color:#6b7280;">
          Por ahora, lo importante es que Firebase est√© funcionando. üòä
        </p>
      </div>
    </div>
  </div>

  <script>
    // --- Configuraci√≥n Firebase (nube) ---
    let db = null;
    let firebaseHabilitado = false;

    try {
      const firebaseConfig = {
        apiKey: "AIzaSyDfCeqv8Nls3NIog-oRCfFFb7_AnUn9TQE",
        authDomain: "acomoda-app2.firebaseapp.com",
        projectId: "acomoda-app2",
        storageBucket: "acomoda-app2.firebasestorage.app",
        messagingSenderId: "453109433788",
        appId: "1:453109433788:web:c41f4b5eedde59f63757b9"
      };

      firebase.initializeApp(firebaseConfig);
      db = firebase.firestore();
      firebaseHabilitado = true;
      console.log("‚úÖ Firebase habilitado (modo nube).");
    } catch (e) {
      console.log("‚ùå Error inicializando Firebase, se usar√° solo localStorage:", e);
    }

    // Mostrar estado de conexi√≥n en la pantalla
    window.addEventListener("load", () => {
      const estadoEl = document.getElementById("estadoConexion");
      if (firebaseHabilitado) {
        estadoEl.textContent = "Conectado a Firebase (modo nube).";
        estadoEl.classList.add("ok");
      } else {
        estadoEl.textContent = "No se pudo conectar a Firebase. Modo local.";
        estadoEl.classList.add("err");
      }
    });

    // --- L√≥gica de ingreso ---
    const PIN_COORDINADOR = "999"; // NO se muestra en la pantalla

    function entrar() {
      const rolEl = document.querySelector('input[name="rol"]:checked');
      const pin = document.getElementById("pinInput").value.trim();

      if (!rolEl) {
        alert("Seleccione si es Coordinador o Acomodador.");
        return;
      }
      if (!pin) {
        alert("Ingrese su PIN.");
        return;
      }

      const rol = rolEl.value;

      if (rol === "coordinador") {
        if (pin !== PIN_COORDINADOR) {
          alert("PIN de coordinador incorrecto.");
          return;
        }
      } else {
        // Acomodador: m√°s adelante podemos validar contra una lista en Firestore/localStorage
      }

      // Si lleg√≥ hasta ac√°, el PIN es v√°lido
      document.getElementById("loginSection").style.display = "none";
      document.getElementById("appSection").style.display = "block";

      const info = document.getElementById("infoUsuario");
      info.textContent =
        (rol === "coordinador" ? "Coordinador" : "Acomodador") +
        " | PIN " +
        pin;
    }

    // --- Prueba de Firebase ---
    function probarFirebase() {
      if (!firebaseHabilitado || !db) {
        alert("Firebase no est√° habilitado. Sigue en modo local.");
        return;
      }

      db.collection("pruebas")
        .add({
          mensaje: "Hola desde AcomodaApp",
          fecha: new Date().toISOString()
        })
        .then(() => {
          document.getElementById("resultadoFirebase").textContent =
            "‚úÖ Firebase guard√≥ un documento en la colecci√≥n 'pruebas'.";
        })
        .catch((error) => {
          console.error("Error guardando en Firebase:", error);
          document.getElementById("resultadoFirebase").textContent =
            "‚ùå Error al guardar en Firebase. Mir√° la consola.";
        });
    }
  </script>
</body>
</html>
